<!DOCTYPE html>
<!--[if lt IE 7 ]> <html class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>Tutorials - HyPhy</title>
      
      
      
        <link rel="canonical" href="http://squidfunk.github.io/mkdocs-material/tutorials/selection/README/">
      
      
        <meta name="author" content="Michael Li">
      
    
    <meta property="og:url" content="http://squidfunk.github.io/mkdocs-material/tutorials/selection/README/">
    <meta property="og:title" content="HyPhy">
    <meta property="og:image" content="http://squidfunk.github.io/mkdocs-material/tutorials/selection/README//../../../images/logo.svg">
    <meta name="apple-mobile-web-app-title" content="HyPhy">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
      <link rel="apple-touch-icon" href="../../../images/logo.svg">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="../../../assets/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="../../../assets/images/favicon.ico">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('../../../assets/fonts/icon.eot?52m981');
      	src: url('../../../assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('../../../assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('../../../assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('../../../assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="../../../assets/stylesheets/application.css">
    <link rel="stylesheet" href="../../../assets/stylesheets/index.css">
		<link rel="stylesheet" href="../../../assets/stylesheets/styles.css">
    <link rel="stylesheet" href="../../../assets/stylesheets/mobile.css">
    
    
      
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu+Mono">
      <style>
        body, input {
          font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
    <script src="../../../assets/javascripts/modernizr.js"></script>
    
  </head>
  
  
  
  <body class=" ">
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="header-title">
        <a href="#">HyPhy//<span class="header-title-light">Hypothesis Testing <br>using Phylogenies</span></a>
      </div>
      
      <div class="mobile-header-title">
        <a href="#">HyPhy</a>
      </div>
    </div>
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false">
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">
  
  <a href="/" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="../../../images/logo.svg">
        </div>
      
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      <div class="toc">
        <ul>
          
            <!-- Render sections -->

  <li>
    <a class=""
      title="Home" href="../../.." >
      Home
    </a>

    <!-- Expand active pages -->
    
  </li>

          
            <!-- Render sections -->

  <li>
    <a class=""
      title="Download" href="../../../download/" >
      Download
    </a>

    <!-- Expand active pages -->
    
  </li>

          
            <!-- Render sections -->

  <li>
    <a class=""
      title="Installation" href="../../../installation/" >
      Installation
    </a>

    <!-- Expand active pages -->
    
  </li>

          
            <!-- Render sections -->

  <li>
    <a class="current"
      title="Tutorials" href="./" >
      Tutorials
    </a>

    <!-- Expand active pages -->
    

      <!--
        The top-level anchor must be skipped if the article contains a h1
        headline, since it would be redundant to the link to the current page
        that is located just above the anchor. Therefore we directly continue
        with the children of the anchor.
      -->
      
        
      

      <!-- Render anchors of active page -->
      
        <ul>
          

            <!-- Render anchor -->
            <li class="anchor">
              <a title="Estimate alignment-wide &omega;." href="#estimate-alignment-wide">
                Estimate alignment-wide &omega;.
              </a>
            </li>
          

            <!-- Render anchor -->
            <li class="anchor">
              <a title="Run alignment-wide tests for episodic diversification (BUSTED)." href="#run-alignment-wide-tests-for-episodic-diversification-busted">
                Run alignment-wide tests for episodic diversification (BUSTED).
              </a>
            </li>
          

            <!-- Render anchor -->
            <li class="anchor">
              <a title="Use aBSREL to find lineages which have experienced episodic diversification." href="#use-absrel-to-find-lineages-which-have-experienced-episodic-diversification">
                Use aBSREL to find lineages which have experienced episodic diversification.
              </a>
            </li>
          

            <!-- Render anchor -->
            <li class="anchor">
              <a title="Use FUBAR to find sites which have experienced pervasive diversification." href="#use-fubar-to-find-sites-which-have-experienced-pervasive-diversification">
                Use FUBAR to find sites which have experienced pervasive diversification.
              </a>
            </li>
          

            <!-- Render anchor -->
            <li class="anchor">
              <a title="Use MEME to find sites which have experienced episodic diversification." href="#use-meme-to-find-sites-which-have-experienced-episodic-diversification">
                Use MEME to find sites which have experienced episodic diversification.
              </a>
            </li>
          

            <!-- Render anchor -->
            <li class="anchor">
              <a title="Use RELAX to compare selective pressures on different parts of the tree" href="#use-relax-to-compare-selective-pressures-on-different-parts-of-the-tree">
                Use RELAX to compare selective pressures on different parts of the tree
              </a>
            </li>
          
        </ul>
      
    
  </li>

          
            <!-- Render sections -->

  <li>
    <a class=""
      title="Glossary" href="../../../glossary/" >
      Glossary
    </a>

    <!-- Expand active pages -->
    
  </li>

          
            <!-- Render sections -->

  <li>
    <a class=""
      title="Support" href="../../../support/" >
      Support
    </a>

    <!-- Expand active pages -->
    
  </li>

          
        </ul>
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          <h1 id="selection-detection">Selection detection<a class="headerlink" href="#selection-detection" title="Permanent link">#</a></h1>
<p><strong>Data files</strong></p>
<p>All the example alignment files used here are available in this <a href="../data">data directory</a>.
You may find it convenient to download the <a href="https://github.com/veg/hyphy-tutorials/blob/master/selection/data/files.zip?raw=true">zip file</a>
with all the files from that directory, and unpack it on your machine.</p>
<p><strong>Notation</strong></p>
<p>We will use the following notation.</p>
<ol>
<li><code>filename</code> refers to a file on your local file system.</li>
<li><strong>Option</strong> refers to an analysis option that you will select when prompted by HyPhy.</li>
<li><em>Menu item</em> refers to a menu option you will select in the Mac OS X or Windows GUI (Graphical User Interface) version of HyPhy,
or a command line you will supply in terminal with the command line version of HyPhy.</li>
<li><tt>X</tt> refers to a model parameter X.</li>
<li>The following formatting denotes text output to the screen by HyPhy.</li>
</ol>
<div class="code"><pre><span></span>[BUSTED] Selected 35 branches as the test (foreground) set: RABENSBURG_ISOLATE,WNFCG,SPU116_89,Node11,Node9,KUNCG,Node8,..
[BUSTED] Obtaining initial branch lengths under the GTR model
[BUSTED] Log(L) = -7745.475588071066
[BUSTED] Fitting the unconstrained branch-site model
</pre></div>


<hr />
<h2 id="estimate-alignment-wide">Estimate alignment-wide &omega;.<a class="headerlink" href="#estimate-alignment-wide" title="Permanent link">#</a></h2>
<ol>
<li>Select the appropriate analysis to run</li>
<li><strong>[if using GUI]</strong> Choose <em>Analysis:Standard Analyses:Basic Analyses:AnalyzeCodonData.bf</em></li>
</ol>
<p><img alt="Selection diaglog" src="../images/GUI-dialog.png" />
  * <strong>[if using CLI]</strong> When presented with the list of standard analysis options upon launch, choose <em>Basic Analyses</em>, then option 1 (<em>Analyse codon data with a variery of standard models using given tree.</em>)</p>
<p><img alt="Selection in terminal" src="../images/CLI-dialog.png" /></p>
<ol>
<li><strong>Universal</strong> genetic code option</li>
<li>The file to process</li>
<li><strong>[GUI]</strong> In the file dialog, navigate to and select <code>WestNileVirus_NS3.fas</code></li>
<li><strong>[CLI]</strong> Input the full path name to the file (make sure there is no trailing space), e.g.
  <code>/Users/sergei/Coding/hyphy-tutorials/selection/data/WestNileVirus_NS3.fas</code></li>
<li><strong>MG94CUSTOMCF3X4</strong> model; the <a href="http://www.ncbi.nlm.nih.gov/pubmed/7968485">Muse Gaut 94</a> model with the <a href="http://journals.plos.org/plosone/article?id=10.1371/journal.pone.0011230">CF3x4</a> frequency estimator.</li>
<li><strong>Global</strong> model parameter option; estimate rate parameters jointly from all sites and branches.</li>
<li><strong>012345</strong> nucleotide substitution rates; estimate the general time reversible (GTR, 5 rates) model.</li>
<li>Confirm that the tree included in the file will be used</li>
<li>
<p><strong>[GUI]</strong> Type <strong>y</strong> into the <strong>bottom box of the console window</strong> (see red box in the image) and hit "Enter"
  <img alt="Entering text" src="../images/GUI-input.png" /></p>
</li>
<li>
<p><strong>[CLI]</strong> Type <strong>y</strong> and hit "Enter"</p>
</li>
<li><strong>Estimate</strong> branch lengths directly</li>
</ol>
<p>The output should look like this</p>
<div class="code"><pre><span></span><span class="nt">______________RESULTS______________</span>
<span class="nt">Log</span> <span class="nt">Likelihood</span> <span class="o">=</span> <span class="nt">-6413</span><span class="nc">.50468184347</span><span class="o">;</span>
<span class="nt">Shared</span> <span class="nt">Parameters</span><span class="o">:</span>
<span class="nt">R</span><span class="o">=</span><span class="nt">0</span><span class="nc">.008557848966878849</span>
<span class="nt">GT</span><span class="o">=</span><span class="nt">0</span><span class="nc">.2303600815210618</span>
<span class="nt">CT</span><span class="o">=</span><span class="nt">1</span><span class="nc">.979989664067556</span>
<span class="nt">CG</span><span class="o">=</span><span class="nt">0</span><span class="nc">.02076764883647483</span>
<span class="nt">AC</span><span class="o">=</span><span class="nt">0</span><span class="nc">.2428440082030551</span>
<span class="nt">AT</span><span class="o">=</span><span class="nt">0</span><span class="nc">.3056061615274677</span>

<span class="nt">Tree</span> <span class="nt">givenTree</span><span class="o">=((((((</span><span class="nt">HNY1999</span><span class="nd">:0</span><span class="nc">.001101787189557129</span><span class="o">,</span><span class="nt">NY99_EQHS</span><span class="nd">:0</span><span class="nc">.00108698796444847</span><span class="o">)</span><span class="nt">Node6</span><span class="nd">:0</span><span class="o">,</span><span class="nt">NY99_FLAMINGO</span><span class="nd">:0</span><span class="o">)</span><span class="nt">Node5</span><span class="nd">:0</span><span class="o">,</span><span class="nt">MEX03</span><span class="nd">:0</span><span class="nc">.003274397587748566</span><span class="o">)</span><span class="nt">Node4</span><span class="nd">:0</span><span class="nc">.001043699094072735</span><span class="o">,</span><span class="nt">IS_98</span><span class="nd">:0</span><span class="nc">.002238969679775947</span><span class="o">)</span><span class="nt">Node3</span><span class="nd">:0</span><span class="nc">.0108106327401535</span><span class="o">,</span><span class="nt">PAH001</span><span class="nd">:0</span><span class="nc">.009947231998139823</span><span class="o">)</span><span class="nt">Node2</span><span class="nd">:0</span><span class="nc">.006480815229843424</span><span class="o">,</span><span class="nt">AST99</span><span class="nd">:0</span><span class="nc">.01679372620666718</span><span class="o">,((((</span><span class="nt">RABENSBURG_ISOLATE</span><span class="nd">:1</span><span class="nc">.05102590132809</span><span class="o">,(</span><span class="nt">WNFCG</span><span class="nd">:0</span><span class="nc">.01053193289945618</span><span class="o">,</span><span class="nt">SPU116_89</span><span class="nd">:0</span><span class="nc">.00569613982107767</span><span class="o">)</span><span class="nt">Node19</span><span class="nd">:0</span><span class="nc">.507068944265484</span><span class="o">)</span><span class="nt">Node17</span><span class="nd">:0</span><span class="nc">.5772661357618611</span><span class="o">,</span><span class="nt">KUNCG</span><span class="nd">:0</span><span class="nc">.08756311980263866</span><span class="o">)</span><span class="nt">Node16</span><span class="nd">:0</span><span class="nc">.06947527827356371</span><span class="o">,(</span><span class="nt">ETHAN4766</span><span class="nd">:0</span><span class="nc">.02385184540957046</span><span class="o">,(</span><span class="nt">CHIN_01</span><span class="nd">:0</span><span class="nc">.01206163326344818</span><span class="o">,</span><span class="nt">EG101</span><span class="nd">:0</span><span class="nc">.01506055273715259</span><span class="o">)</span><span class="nt">Node25</span><span class="nd">:0</span><span class="nc">.007681688497219724</span><span class="o">)</span><span class="nt">Node23</span><span class="nd">:0</span><span class="nc">.003442808476468687</span><span class="o">)</span><span class="nt">Node15</span><span class="nd">:0</span><span class="nc">.01851421610241251</span><span class="o">,(((</span><span class="nt">ITALY_1998_EQUINE</span><span class="nd">:0</span><span class="nc">.009037431851104481</span><span class="o">,</span><span class="nt">PAAN001</span><span class="nd">:0</span><span class="nc">.007872553578665653</span><span class="o">)</span><span class="nt">Node30</span><span class="nd">:0</span><span class="nc">.002694356278175029</span><span class="o">,(</span><span class="nt">RO97_50</span><span class="nd">:0</span><span class="nc">.001642931262019352</span><span class="o">,</span><span class="nt">VLG_4</span><span class="nd">:0</span><span class="nc">.00108305411902561</span><span class="o">)</span><span class="nt">Node33</span><span class="nd">:0</span><span class="nc">.002794580801147744</span><span class="o">)</span><span class="nt">Node29</span><span class="nd">:0</span><span class="nc">.0007243769694723316</span><span class="o">,</span><span class="nt">KN3829</span><span class="nd">:0</span><span class="nc">.003058011972423634</span><span class="o">)</span><span class="nt">Node28</span><span class="nd">:0</span><span class="nc">.01097965849521703</span><span class="o">)</span><span class="nt">Node14</span><span class="nd">:0</span><span class="nc">.00929314901848397</span><span class="o">);</span>
</pre></div>


<p>The <tt>R</tt> parameter denotes the global &omega; (dN/dS) ratio and is the object of this analysis.</p>
<hr />
<h2 id="run-alignment-wide-tests-for-episodic-diversification-busted">Run alignment-wide tests for episodic diversification (BUSTED).<a class="headerlink" href="#run-alignment-wide-tests-for-episodic-diversification-busted" title="Permanent link">#</a></h2>
<blockquote>
<p>BUSTED is a method described in <a href="http://www.ncbi.nlm.nih.gov/pubmed/25701167">Murrell et al</a>. It has been extensively tested and shows better power and accuracy than either <a href="http://mbe.oxfordjournals.org/content/24/5/1219.short">"branch-site" models in PAML</a>, or the <a href="http://mbe.oxfordjournals.org/content/early/2013/10/16/molbev.mst198">"covarion" style models</a></p>
</blockquote>
<p>We will perform branch-site model-based tests for episodic selection affecting a proportion of sites in
the alignment along a proportion of branches in the tree (i.e. is there evidence of selection <strong>anywhere</strong> in the alignment and <strong>anywhere</strong> on the tree).
The data set in we are using includes partial clonal HIV-1 env sequences from epidemiologically linked partners (source and recipient)</p>
<ol>
<li>Select the appropriate analysis to run</li>
<li><strong>[GUI]</strong> Choose <em>Analysis:Standard Analyses:Positive Selection:BUSTED.bf</em></li>
<li><strong>[CLI]</strong> When presented with the list of standard analysis options upon launch, choose <em>Positive Selection</em>, then option 4 (<em>Run the Branch-site Unrestricted Statistical Test for Episodic Diversification to test for evidence of episodic alignment-wide selective pressure.</em>)</li>
<li><strong>Universal</strong> genetic code option</li>
<li>The file to process</li>
<li><strong>[GUI]</strong> In the file dialog, navigate to and select <code>HIV.nex</code></li>
<li><strong>[CLI]</strong> Input the full path name to the file (make sure there is no trailing space), e.g. <code>/Users/sergei/Coding/hyphy-tutorials/selection/data/HIV.nex</code></li>
<li>Confirm that the tree included in the file will be used</li>
<li><strong>[GUI]</strong> Type <strong>y</strong> into the bottom box of the console window and hit Enter</li>
<li><strong>[CLI]</strong> Type <strong>y</strong> and hit Enter</li>
<li>Choose all branches to include in the test (<strong>All</strong>)</li>
<li><strong>[CLI]</strong> You will need to type <strong>d</strong> and hit "Enter" after selecting the <strong>All</strong> option to exit the selection dialog.</li>
</ol>
<p>The analysis will now run for a few minutes and produce the following output</p>
<div class="code"><pre><span></span>[BUSTED] Selected 26 branches as the test (foreground) set: R20_239,R20_245,Node5,R20_240,R20_238,R20_242,Node4,R20_241,Node3,R20_243,Node2,R20_244,Node1,D20_233,D20_235,D20_236,D20_232,Node17,D20_234,D20_237,Node21,Node16,D20_230,D20_231,Node24,Node15 
[BUSTED] Obtaining initial branch lengths under the GTR model 
[BUSTED] Log(L) = -2114.132335772669 
[BUSTED] Fitting the unconstrained branch-site model 
[BUSTED] Log(L) = -2039.992959126133. Unrestricted class omega = 104.6591567580357 (weight = 0.02032866068122922) 
[BUSTED] Fitting the branch-site model that disallows omega &gt; 1 among foreground branches 
[BUSTED] Log(L) = -2076.666683221396 
[BUSTED] Likelihood ratio test for episodic positive selection, p = 1.110223024625157e-16 
</pre></div>


<p>For example, in this case the analysis inferred that</p>
<ol>
<li>A proportion of sites (~0.02) is evolving with dN/dS &gt; 1 (~105) along a subset of the branches (it is not known which).</li>
<li>Forcing dN/dS = 1 provides a significantly worse (p ~ 10<sup>-16</sup>) fit to the data, i.e. rejects the hypothesis of no positive selection in the alignment.</li>
</ol>
<p>In addition to this output, HyPhy will also generate a <a href="http://json.org">JSON</a> file with a more detailed analysis output. The JSON will be written to same directory as the input alignment file, with <code>BUSTED.json</code> appended to the file name, e.g. <code>/Users/sergei/Coding/hyphy-tutorials/selection/data/HIV.nex.BUSTED.json</code>  This JSON file can be visualized and explored with this <a href="http://veg.github.io/hyphy-vision/busted/">web app</a>, e.g., to obtain plots like those shown in the lecture slides.</p>
<h3 id="run-busted-using-datamonkeyorg">Run BUSTED using datamonkey.org<a class="headerlink" href="#run-busted-using-datamonkeyorg" title="Permanent link">#</a></h3>
<ol>
<li>Navigate to http://test.datamonkey.org, selected <em>BUSTED</em> from the <em>Methods and Tools</em> menu.</li>
<li>Choose the file to analyze on the next screen.</li>
<li>Use the analysis setup screen to select all the <code>donor</code> branches as the foreground (shift-click on the branches to add them to selection)
<img alt="BUSTED datamonkey" src="../images/busted-datamonkey.png" /></li>
<li>As the analysis runs, you will see a progress page looking something  like this
<img alt="BUSTED datamonkey progess" src="../images/busted-datamonkey-progress.png" /></li>
<li>When the analysis finishes, you will be directed to a results page, which is very similar to the web app referenced above</li>
</ol>
<h3 id="testing-for-selection-on-an-a-priori-specified-set-of-branches">Testing for selection on an <em>a priori</em> specified set of branches<a class="headerlink" href="#testing-for-selection-on-an-a-priori-specified-set-of-branches" title="Permanent link">#</a></h3>
<p>The tree in the <code>HIV.nex</code> is annotated with {} to indicate the set of test ("foreground") branches (e.g. you can use this <a href="http://veg.github.io/phylotree.js/">widget</a> to select foreground
branches and then export them to Newick using the <em>Newick:Export</em> menu dialog).</p>
<p>in this case the branch being tested is the <em>transmission</em> branch, i.e. the one separating the source and the recipient in the phylogenetic tree.
BUSTED will only constrain &omega; &lt; 1 on these branches (allowing the rest of the tree to have its own &omega; distribution) during testing.</p>
<p>An annotated Newick string looks like this (a single branch):</p>
<blockquote>
<p>((((((R20_239:0.001179071552709126,R20_245:0.003569393318767422):0.002373643652152119,R20_240:0.00354445225954759,
R20_238:0,R20_242:0.007143686359514547):0.001169032517101171,R20_241:0.003555888002841892):0.001829250056707198,
R20_243:0.006486065374683752):0.003845820830922537,R20_244:0.02113434306810657)<strong>{Test}</strong>:0.03269082780807394,
D20_233:0.02550919363771013,(((D20_235:0,D20_236:0,D20_232:0):0.006433904687642939,
(D20_234:0,D20_237:0):0.005843978498632621):0.01022675723558638,
(D20_230:0.02979851732996924,D20_231:0.006905678660095517):0.02444611465196596):0.005946252173834307);</p>
</blockquote>
<p>Repeat the analysis from the previous section, choosing option 4 (<strong>Set Test</strong>) in step 5.
Note that you could also manually select the set of branches to test in the same dialog.</p>
<p>The results of this <em>a priori</em> analysis are</p>
<div class="code"><pre><span></span>[BUSTED] Selected 1 branches as the test (foreground) set: Node1 
[BUSTED] Obtaining initial branch lengths under the GTR model 
[BUSTED] Log(L) = -2114.13233621422 
[BUSTED] Fitting the unconstrained branch-site model 
[BUSTED] Log(L) = -2031.302017161514. Unrestricted class omega = 524.9720891747666 (weight = 0.07815647810018292) 
[BUSTED] Fitting the branch-site model that disallows omega &gt; 1 among foreground branches 
[BUSTED] Log(L) = -2050.101940483789 
[BUSTED] Likelihood ratio test for episodic positive selection, p = 6.843795752331516e-09 
</pre></div>


<h4 id="questions">Questions.<a class="headerlink" href="#questions" title="Permanent link">#</a></h4>
<ol>
<li>Use the <a href="http://veg.github.io/hyphy-vision/busted/">web app</a> to visualize the JSON result file from this analysis and
compare the inferred &omega; distributions for the foreground and background branches.</li>
<li>Explain why the log-likelihood for the unconstrained model is higher for the case when <em>a priori</em> branches are tested?</li>
<li>Do these results suggest that the transmission branch is evolving differently from the rest of the tree?</li>
<li>If the <em>a priori</em> analysis had a negative result (no selection along the transmission branch), might it still be possible to
find evidence of selection in the <strong>All</strong> branches analysis?</li>
</ol>
<hr />
<h2 id="use-absrel-to-find-lineages-which-have-experienced-episodic-diversification">Use aBSREL to find lineages which have experienced episodic diversification.<a class="headerlink" href="#use-absrel-to-find-lineages-which-have-experienced-episodic-diversification" title="Permanent link">#</a></h2>
<blockquote>
<p>aBSREL is a method described in <a href="http://www.ncbi.nlm.nih.gov/pubmed/25697341">Smith et al</a>. It is an extension of our popular <a href="http://www.ncbi.nlm.nih.gov/pubmed/21670087">BS-REL model</a>, which performs a complexity analysis and model selection prior to doing hypothesis testing. It runs much faster than BS-REL and has better statistical properies.</p>
</blockquote>
<p>We continue using the <code>HIV.nex</code> dataset from the previous example, but now we are interested in scanning the phylogeny
for all the branches where selection may have operated.</p>
<ol>
<li>Select the appropriate analysis to run</li>
<li><strong>[GUI]</strong> Choose <em>Analysis:Standard Analyses:Positive Selection:BranchSiteREL.bf</em></li>
<li><strong>[CLI]</strong> When presented with the list of standard analysis options upon launch, choose <em>Positive Selection</em>, then option 1 (<em>Use the random effects branch-site model (2010) to find lineages subject to episodic selection.</em>)</li>
<li><strong>Universal</strong> genetic code option</li>
<li><strong>Yes</strong> to choose the adaptive version of BSREL.</li>
<li><strong>No</strong> to assume that synonymous rates do not vary from site to site</li>
<li>The file to process</li>
<li><strong>[GUI]</strong> In the file dialog, navigate to and select <code>HIV.nex'</code></li>
<li><strong>[CLI]</strong> Input the full path name to the file (make sure there is no trailing space), e.g. <code>/Users/sergei/Coding/hyphy-tutorials/selection/data/HIV.nex</code></li>
<li>Decline to use the tree included in the file (annotation from the previous step conflicts with the current aBSREL implementaton)</li>
<li><strong>[GUI]</strong> Type <strong>n</strong> into the bottom box of the console window and hit Enter</li>
<li><strong>[CLI]</strong> Type <strong>n</strong> and hit Enter</li>
<li>Choose the tree file</li>
<li><strong>[GUI]</strong> In the file dialog, navigate to and select <code>HIV.nwk'</code></li>
<li><strong>[CLI]</strong> Input the full path name to the file (make sure there is no trailing space), e.g. <code>/Users/sergei/Coding/hyphy-tutorials/selection/data/HIV.nwk</code></li>
<li>Choose all branches to test (<strong>All</strong>)</li>
<li><strong>[CLI]</strong> You will need to type <strong>d</strong> and hit Enter after selecting the <strong>All</strong> option to exit the selection dialog.</li>
<li>Where to save the analysis results (more than one file, see below)</li>
<li><strong>[GUI]</strong> In the file dialog, find a place to save the result file, naming it <code>HIV.aBSREL</code>.</li>
<li><strong>[CLI]</strong> Input the full path name to the file (make sure there is no trailing space), e.g. <code>/Users/sergei/Coding/hyphy-tutorials/selection/data/HIV.aBSREL</code></li>
</ol>
<p>The analysis will now run for several minutes and produce a lot of diagnostic output.</p>
<p>As the initial phase, aBSREL fits the standard Muse-Gaut 94 model which estimates a single &omega; for each branch and prints out model fit statistics. This is the simplest model that can be selected by aBSREL.</p>
<div class="code"><pre><span></span>[PHASE 0] Fitting the local MG94 (no site-to-site variation) to obtain initial parameter estimates

Log L = -2069.673153141118 with 66 degrees of freedom. IC = 4273.293894919101

Branch omega values

    Count    = 26
    Mean     = 5.015163008040247
    Median   = 1.911847453671735
    Variance = 20.26898469566522
    Std.Dev  = 4.502108916459621
    COV      = 0.8976994185915583
    Sum      = 130.3942382090464
    Sq. sum  = 1160.672977319228
    Skewness = 0.8547462897381892
    Kurtosis = 58.55544061358484
    Min      = 0.1474879956566399
    2.5%     = 0.1474879956566399
    97.5%    = 10
    Max      = 10
</pre></div>


<p>Next, aBSREL sorts all the branches by length (longest first), and tries to greedily add &omega; categories to one branch at a time, until the addition is no longer justified by AIC<sub>c</sub> scores. For example, for <em>Node1</em> (the transmission branch)</p>
<div class="code"><pre><span></span>[PHASE 1] Fitting Branch Site REL models to one branch at a time

[PHASE 1] Branch Node1 log(L) = -2048.380, IC = 4234.826
    2 rate classes
    Node: mixtureTree.Node1
    Length parameter = 0.01335020389229876
    Class 1
        omega = 0.736
        weight = 0.927
    Class 2
        omega = 499.798
        weight = 0.073

[PHASE 1] Branch Node1 log(L) = -2048.447423263603, IC = 4239.085721554758
    3 rate classes
    Node: mixtureTree.Node1
    Length parameter = 0.0194263003300435
    Class 1
        omega = 0.385
        weight = 0.925
    Class 2
        omega = 0.000
        weight = 0.000
    Class 3
        omega = 314.702
        weight = 0.075
</pre></div>


<p>using two rate classes improves the IC from 4273.3 to 4234.83, but going to three rate classes is not justified. aBSREL will now fix a 2-bin &omega; distribution for <tt>Node1</tt> and move to the next branch. When all branches are done, a summary of inferred model complexity will be printed to the screen.</p>
<div class="code"><pre><span></span><span class="k">[INFERRED MODEL COMPLEXITY]</span>
    <span class="err">mixtureTree.R20_239</span> <span class="err">has</span> <span class="err">1</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
    <span class="err">mixtureTree.R20_245</span> <span class="err">has</span> <span class="err">1</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
    <span class="err">mixtureTree.Node5</span> <span class="err">has</span> <span class="err">1</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
    <span class="err">mixtureTree.R20_240</span> <span class="err">has</span> <span class="err">1</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
    <span class="err">mixtureTree.R20_238</span> <span class="err">has</span> <span class="err">1</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
    <span class="err">mixtureTree.R20_242</span> <span class="err">has</span> <span class="err">1</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
    <span class="err">mixtureTree.Node4</span> <span class="err">has</span> <span class="err">1</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
    <span class="err">mixtureTree.R20_241</span> <span class="err">has</span> <span class="err">1</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
    <span class="err">mixtureTree.Node3</span> <span class="err">has</span> <span class="err">1</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
    <span class="err">mixtureTree.R20_243</span> <span class="err">has</span> <span class="err">1</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
    <span class="err">mixtureTree.Node2</span> <span class="err">has</span> <span class="err">1</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
    <span class="err">mixtureTree.R20_244</span> <span class="err">has</span> <span class="err">1</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
    <span class="err">mixtureTree.Node1</span> <span class="err">has</span> <span class="err">2</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
    <span class="err">mixtureTree.D20_233</span> <span class="err">has</span> <span class="err">2</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
    <span class="err">mixtureTree.D20_235</span> <span class="err">has</span> <span class="err">1</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
    <span class="err">mixtureTree.D20_236</span> <span class="err">has</span> <span class="err">1</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
    <span class="err">mixtureTree.D20_232</span> <span class="err">has</span> <span class="err">1</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
    <span class="err">mixtureTree.Node17</span> <span class="err">has</span> <span class="err">1</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
    <span class="err">mixtureTree.D20_234</span> <span class="err">has</span> <span class="err">1</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
    <span class="err">mixtureTree.D20_237</span> <span class="err">has</span> <span class="err">1</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
    <span class="err">mixtureTree.Node21</span> <span class="err">has</span> <span class="err">1</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
    <span class="err">mixtureTree.Node16</span> <span class="err">has</span> <span class="err">2</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
    <span class="err">mixtureTree.D20_230</span> <span class="err">has</span> <span class="err">2</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
    <span class="err">mixtureTree.D20_231</span> <span class="err">has</span> <span class="err">1</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
    <span class="err">mixtureTree.Node24</span> <span class="err">has</span> <span class="err">2</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
    <span class="err">mixtureTree.Node15</span> <span class="err">has</span> <span class="err">1</span> <span class="err">site</span> <span class="err">rate</span> <span class="err">classes</span>
</pre></div>


<p>Note that only a few branches support 2 &omega; classes, and the majority are well-explained without any site-to-site variation.
In the next phase, aBSREL optimizes all parameters in the just inferred model model</p>
<div class="code"><pre><span></span>[PHASE 2] Fitting the full LOCAL alternative model (no constraints)

Log L = -2010.471450731734 with 76 degrees of freedom, IC = 4175.52599570315
((((((R20_239:0.001180872214151883,R20_245:0.003568958594949872)Node5:0.00238190144130175,R20_240:0.003553829750818045,R20_238:0,R20_242:0.00716830032133561)Node4:0.001173481128053423,R20_241:0.003576676330678178)Node3:0.00155544697576297,R20_243:0.006756755941630225)Node2:0.00415900454948532,R20_244:0.02082000515352331)Node1:0.2905921716926325,D20_233:1.951982256546112,(((D20_235:0,D20_236:0,D20_232:0)Node17:0.006441027083836533,(D20_234:0,D20_237:0)Node21:0.005840812770752585)Node16:0.2538902924947701,(D20_230:1.765119288716005,D20_231:0.007781540968601186)Node24:0.02458866035691175)Node15:0)
</pre></div>


<p>Next, the analysis will proceed to test all the branches we selected in step 8 (which is <em>All</em>) to see if there is a proportion of sites
with &omega; &gt; 1 along that branch, and whose removal would cause a significant drop in log-likelihood. As a shortcut, if the branch has no sites with &omega; &gt; 1, it will not be tested (one can just set the p-value to 0.5).</p>
<p>This is the most time consuming phase of the analysis. As the tests are done, aBSREL will print out a running tally to the screen, including the rate distribution inferred for a particular branch under the null (&omega; &le; 1) model, and the p-value for the branch. For example, the snippet below shows the alternative and null distributions of &omega; along Node1 (the same branch we tested with BUSTED previously), and reports the <em>uncorrected</em> p-value for the test of selection at this branch.</p>
<div class="code"><pre><span></span><span class="n">Node</span><span class="o">:</span> <span class="n">mixtureTree</span><span class="o">.</span><span class="na">Node1</span>
    <span class="n">Length</span> <span class="n">parameter</span> <span class="o">=</span> <span class="mf">0.02933683537846648</span>
    <span class="n">Class</span> <span class="mi">1</span>
        <span class="n">omega</span> <span class="o">=</span> <span class="mf">0.872</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="mf">0.932</span>
    <span class="n">Class</span> <span class="mi">2</span>
        <span class="n">omega</span> <span class="o">=</span> <span class="mf">751.770</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="mf">0.068</span>
<span class="o">...</span><span class="n">Testing</span> <span class="k">for</span> <span class="n">selection</span> <span class="n">at</span> <span class="k">this</span> <span class="n">branch</span>

<span class="n">Node</span><span class="o">:</span> <span class="n">mixtureTree</span><span class="o">.</span><span class="na">Node1</span>
    <span class="n">Length</span> <span class="n">parameter</span> <span class="o">=</span> <span class="mf">0.08668188509082339</span>
    <span class="n">Class</span> <span class="mi">1</span>
        <span class="n">omega</span> <span class="o">=</span> <span class="mf">0.816</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="mf">0.000</span>
    <span class="n">Class</span> <span class="mi">2</span>
        <span class="n">omega</span> <span class="o">=</span> <span class="mf">1.000</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="mf">1.000</span>
<span class="n">p</span><span class="o">-</span><span class="n">value</span> <span class="o">=</span> <span class="mf">9.103440223867665</span><span class="n">e</span><span class="o">-</span><span class="mi">12</span>
</pre></div>


<p>Once all the tests have been done, aBSREL will print out the list of all branches with p-values below 0.05 <strong>after</strong>
applying the <a href="http://en.wikipedia.org/wiki/Holm–Bonferroni_method">Holm-Bonferroni multiple testing correction</a>, and a CPU time report.</p>
<div class="code"><pre><span></span>Summary of branches under episodic selection (26 were tested, of which 14 required optimizations) :
    Node1 p = 2.45792886044427e-10
    D20_233 p = 0.0001215300920816009
    Node16 p = 0.0002149117196342809


 === CPU TIME REPORT === 
    MG94 model fit : 00:00:05
    Rate class complexity analysis : 00:00:33
    aBSREL model fit : 00:00:07
    Individual branch selection testing : 00:01:29
    Total time : 00:02:43
</pre></div>


<p>Output files generated by aBSREL will all be of the form <code>PREFIX.extension</code> where PREFIX is whatever you chose in step 9 above.</p>
<ul>
<li><code>PREFIX.mglocal.fit</code> : a HyPhy batch file containing the model fit (including all parameter estimates) of PHASE 0 (only branch variation). This is a NEXUS file with a private NEXUS HYPHY block.</li>
<li><code>PREFIX.fit</code> : a HyPhy batch file containing the model fit (including all parameter estimates) of PHASE 2 (unconstrained branch-site model). This is a NEXUS file with a private NEXUS HYPHY block.</li>
<li><code>PREFIX.json</code>: a JSON file storing all the relevant analysis output, it can be visualized with this <a href="http://veg.github.io/hyphy-vision/absrel/">web app</a></li>
<li><code>PREFIX</code>: a CSV file containing branch-by-branch output (similar to what is shown in the <em>Table</em> tab of the web app)</li>
</ul>
<h3 id="questions_1">Questions.<a class="headerlink" href="#questions_1" title="Permanent link">#</a></h3>
<ol>
<li>Which model (aBSREL or BUSTED) provides a better fit to the data, based on AIC<sub>c</sub> (the web apps report AIC<sub>c</sub> in the summary table)? </li>
<li>Compare the &omega; distributions inferred for Node1 (the transmission branch) by BUSTED with the <em>a priori</em> branch selection, and by aBSREL. If they differ, can you identify some of the key differences between the models that could explain the difference?</li>
<li>Use the <a href="http://veg.github.io/hyphy-vision/absrel/">web app</a> to compare the list of branches which would have p-values &le; 0.05 without the multiple test correction. Are the lists notably different?</li>
</ol>
<hr />
<h2 id="use-fubar-to-find-sites-which-have-experienced-pervasive-diversification">Use FUBAR to find sites which have experienced pervasive diversification.<a class="headerlink" href="#use-fubar-to-find-sites-which-have-experienced-pervasive-diversification" title="Permanent link">#</a></h2>
<blockquote>
<p>FUBAR is described in <a href="http://mbe.oxfordjournals.org/content/30/5/1196">Murrell et al</a> which is intended to supersede (by dint of its speed and statistical performance), previous REL and FEL methods.</p>
</blockquote>
<p>We will use the <code>WestNileVirus_NS3.fas</code> dataset to identify individual sites which have experienced pervasive diversification over the entire tree. An analysis by <a href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2291521/">Brault et al</a> using our older counting method (SLAC),
found a single site (249) subject to positive selection.</p>
<ol>
<li>Select the appropriate analysis to run</li>
<li><strong>[GUI]</strong> Choose <em>Analysis:Standard Analyses:Selection/Recombination:FUBAR.bf</em></li>
<li><strong>[CLI]</strong> When presented with the list of standard analysis options upon launch, choose <em>Selection/Recombination</em>, then option 1 (<em>Detect site-specific pervasive diversifying and purifying selection using the FUBAR (Fast Unbiased Bayesian AppRoximate) method on a multiple partition data set, e.g. produced by GARD.</em>). Note that, as suggested by the text, FUBAR can account for the confounding effect of recombination.</li>
<li><strong>Universal</strong> genetic code option</li>
<li><strong>1</strong> to specify that a single partition is being analyzed (you could specify more to correct for recombination).</li>
<li>Confirm that the tree included in the file will be used</li>
<li><strong>[GUI]</strong> Type <strong>y</strong> into the bottom box of the console window and hit Enter</li>
<li><strong>[CLI]</strong> Type <strong>y</strong> and hit Enter</li>
<li>The file to process</li>
<li><strong>[GUI]</strong> In the file dialog, navigate to and select <code>HIV.nex'</code></li>
<li><strong>[CLI]</strong> Input the full path name to the file (make sure there is no trailing space), e.g. <code>/Users/sergei/Coding/hyphy-tutorials/selection/data//WestNileVirus_NS3.fas</code>. The analysis will now begin running (see output below but more propmts await). As BUSTED and aBSREL, FUBAR will write a number of <code>PREFIX.exention</code> files to disk. <code>PREFIX</code> is the path to the alignment file in this case, and the context of h</li>
<li>Choose N to define an NxN grid (use the default 20)</li>
<li><strong>[GUI]</strong> Type <strong>20</strong> into the bottom box of the console window and hit Enter</li>
<li><strong>[CLI]</strong> Type <strong>20</strong> and hit Enter</li>
<li>Choose the number of MCMC chains to run (use <strong>3</strong>)</li>
<li>Specify Markov chain parameters (use suggested defaults, i.e., <strong>2000000</strong>, <strong>1000000</strong>, <strong>100</strong>, <strong>0.05</strong>)</li>
<li><strong>[GUI]</strong> Type <strong>3</strong> into the bottom box of the console window and hit Enter</li>
<li><strong>[CLI]</strong> Type <strong>3</strong> and hit Enter</li>
</ol>
<p><strong>Output after Step 5</strong></p>
<div class="code"><pre><span></span>FUBAR will write intermediate and result files to
/Users/sergei/Coding/hyphy-tutorials/selection/data/WestNileVirus_NS3.fas.extension

[FUBAR PHASE 1] Optimizing relative branch lengths under the nucleotide REV model
[FUBAR PHASE 1 FINISHED] log(L) = -7745.475468266388
    Length of tree 1 (substitutions/site) = 0.6721285491158012
[DIAGNOSTIC] FUBAR wrote the self-contained nucleotide fit file to /Users/sergei/Coding/hyphy-tutorials/selection/data/WestNileVirus_NS3.fas.gtr_fit
</pre></div>


<p><strong>Output after Step 6</strong></p>
<div class="code"><pre><span></span>[DIAGNOSTIC] FUBAR will use a 20X20 grid
[FUBAR PHASE 2] Determining appropriate branch scaling using the 20X20 grid points.
Computing the likelihood function on grid points 400/400 00:00:02   Best scaling achieved for dN/dS =  0.03.
    Computing site-by-site likelihoods at 20X20 grid points
Computing the likelihood function on grid points 400/400 00:00:03   Finished with likelihood calculations. Achieved throughput of  66.67 calculations/second
[DIAGNOSTIC] FUBAR wrote the self-contained codon fit file to /Users/sergei/Coding/hyphy-tutorials/selection/data/WestNileVirus_NS3.fas.codon_fit
[DIAGNOSTIC] FUBAR wrote the the site likelihoods file to /Users/sergei/Coding/hyphy-tutorials/selection/data/WestNileVirus_NS3.fas.grid_info
</pre></div>


<p><strong>Output after Step 8</strong></p>
<div class="code"><pre><span></span>[FUBAR PHASE 3] Running an MCMC chain (ID 0) to obtain a posterior sample of grid point weights: 2000000 total steps, of which 1000000 will be discarded as burn-in, and sampling every 10000 steps. Dirichlet prior concentration parameter = 0.5.
Running MCMC chain ID 0. Current step: 2000000/2000000. Mean sampled log(L) = -6619.31564200728. Acceptance rate = 0.03111951555975778
[FUBAR PHASE 3] Running an MCMC chain (ID 1) to obtain a posterior sample of grid point weights: 2000000 total steps, of which 1000000 will be discarded as burn-in, and sampling every 10000 steps. Dirichlet prior concentration parameter = 0.5.
Running MCMC chain ID 1. Current step: 2000000/2000000. Mean sampled log(L) = -6619.258683970502. Acceptance rate = 0.03157801578900789
[FUBAR PHASE 3] Running an MCMC chain (ID 2) to obtain a posterior sample of grid point weights: 2000000 total steps, of which 1000000 will be discarded as burn-in, and sampling every 10000 steps. Dirichlet prior concentration parameter = 0.5.
Running MCMC chain ID 2. Current step: 2000000/2000000. Mean sampled log(L) = -6620.143375380813. Acceptance rate = 0.03128851564425782
[FUBAR PHASE 3 DONE] Finished running the MCMC chains; drew 3x100 samples from chains of length 2000000 after discarding 1000000 burn-in steps. Achieved throughput of 125000 moves/sec.

[DIAGNOSTIC] FUBAR wrote samples from 3 independent chains to /Users/sergei/Coding/hyphy-tutorials/selection/data/WestNileVirus_NS3.fas.samples[0-2]


Tabulating results for site 618/619 00:00:01
[DIAGNOSTIC] FUBAR wrote the results of its analysis to /Users/sergei/Coding/hyphy-tutorials/selection/data/WestNileVirus_NS3.fas.fubar.csv
</pre></div>


<p><strong>Final results</strong></p>
<div class="code"><pre><span></span>[RESULTS] At posterior probability &gt;= 0.9 there were 1 sites under diversifying positive selection, of which  0.01 [0 - 0] are expected to be false positives.

Codon   Prob[dN/dS&gt;1]   EBF[dN/dS]&gt;1    PSRF    N_eff
249 0.9877421834151304  562.1145080622537   1.063515998847144   24.05393297483982
</pre></div>


<h3 id="questions_2">Questions<a class="headerlink" href="#questions_2" title="Permanent link">#</a></h3>
<ol>
<li>Try the same analysis with different grid sizes (5,10,30).</li>
<li>How do the run times change?</li>
<li>Are the results robust to the choice of N?</li>
<li>Run FUBAR with using the same settings on a large HIV RT dataset (&gt;400 sequences) <code>HIV_RT.nex</code>, which was previously analyzed by us using a [dedicated method for finding directional selection, MEDS] (http://www.ploscompbiol.org/article/info%3Adoi%2F10.1371%2Fjournal.pcbi.1002507).</li>
<li>How does FUBAR time scale with the number of sequences?</li>
<li>How does the list of sites found by FUBAR compare with the MEDS paper?</li>
<li>And with the list of sites known for their as resistance associated for <a href="http://hivdb.stanford.edu/DR/NNRTIResiNote.html">NNRTI</a> and <a href="http://hivdb.stanford.edu/DR/NRTIResiNote.html">NRTI</a>?</li>
<li>Explore the effect of correcting for recombination with partitioning, by running FUBAR on <code>CVV_G.fas</code> [no partitioning] and <code>CVV_G_GARD.nex</code> [partitioning into non-recombinant fragments using GARD]. How different are the lists of sites produced by the analyses?</li>
</ol>
<hr />
<h2 id="use-meme-to-find-sites-which-have-experienced-episodic-diversification">Use MEME to find sites which have experienced episodic diversification.<a class="headerlink" href="#use-meme-to-find-sites-which-have-experienced-episodic-diversification" title="Permanent link">#</a></h2>
<blockquote>
<p>MEME is a <a href="http://www.plosgenetics.org/article/info%3Adoi%2F10.1371%2Fjournal.pgen.1002764">published method</a> which is our default recommendation for finding individual sites under selection. It is MUCH slower than FUBAR, however, so there's room for both.</p>
</blockquote>
<p>We continue to use the <code>WestNileVirus_NS3.fas</code> dataset from the previous example, to find sites where selection operated along a subset of branches, while the rest of the tree may have been strongly conserved (in <strong>addition</strong> to the type of sites found by FUBAR).</p>
<p>MEME tests each individual site separately; it runs quite slowly on a desktop, but very quickly on a cluster. You may also run MEME on <a href="../www.datamonkey.org">datamonkey</a> to speed up the process. MEME requires a lot of user input (this is a legacy issue and will be addressed in the upcoming HyPhy v3 release).</p>
<ol>
<li>Select the appropriate analysis to run</li>
<li><strong>[GUI]</strong> Choose <em>Analysis:Standard Analyses:Selection:QuickSelectionDetection.bf</em></li>
<li><strong>[CLI]</strong> When presented with the list of standard analysis options upon launch, choose <em>Positive Selection</em> (10), then option 9 (<em>Quickly test for positive selection using several approaches.</em>).</li>
<li><strong>Universal</strong> genetic code option</li>
<li><strong>New analysis</strong></li>
<li>The file to process</li>
<li><strong>[GUI]</strong> In the file dialog, navigate to and select <code>HIV.nex'</code></li>
<li><strong>[CLI]</strong> Input the full path name to the file (make sure there is no trailing space), e.g. <code>/Users/sergei/Coding/hyphy-tutorials/selection/data/WestNileVirus_NS3.fas</code>.</li>
<li><strong>012345</strong> (GTR combined with the codon model)</li>
<li>Confirm that the tree included in the file will be used</li>
<li><strong>[GUI]</strong> Type <strong>y</strong> into the bottom box of the console window and hit Enter</li>
<li><strong>[CLI]</strong> Type <strong>y</strong> and hit Enter</li>
<li>Save nucleotide model fit to <code>PREFIX.gtr</code>. We'll replace PREFIX with somewhere on the file system you wish to save the results to, e.g., <code>/Users/sergei/Coding/hyphy-tutorials/selection/data/WestNileVirus_NS3_meme</code></li>
<li><strong>Estimate dN/dS only</strong></li>
<li><strong>MEME</strong> (HyPhy will start running the analysis now)</li>
<li><strong>0.1</strong> for the p-value (MEME is a conservative test on small alignments)</li>
<li><strong>N</strong> (do not save fit files for individual codons)</li>
<li>[This prompt will appear <strong>after</strong> the analysis is finished] Save the CSV file with analysis results to <code>PREFIX.csv</code>, e.g., <code>/Users/sergei/Coding/hyphy-tutorials/selection/data/WestNileVirus_NS3_meme</code></li>
</ol>
<p><strong>Output after step 8</strong></p>
<div class="code"><pre><span></span><span class="nv">Phase</span> <span class="mi">1</span><span class="s s-Atom">:</span><span class="nv">Nucleotide</span> <span class="nv">Model</span> <span class="p">(</span><span class="mi">012345</span><span class="p">)</span> <span class="nv">Model</span> <span class="nv">Fit</span>


<span class="o">-</span><span class="mf">7745.47549841979</span>

<span class="nv">Phase</span> <span class="mi">2</span><span class="s s-Atom">:</span><span class="nv">MG94x</span><span class="p">(</span><span class="mi">012345</span><span class="p">)</span> <span class="nv">Model</span> <span class="nv">Fit</span>



<span class="nv">Phase</span> <span class="mi">3</span><span class="s s-Atom">:</span><span class="nv">Estimating</span> <span class="s s-Atom">dN</span><span class="o">/</span><span class="s s-Atom">dS</span>


<span class="nv">Nuc</span><span class="s s-Atom">-&gt;codon</span> <span class="s s-Atom">scaling</span> <span class="nn">factor</span><span class="p">:</span><span class="mf">3.091598974159624</span>
<span class="nv">Raw</span> <span class="s s-Atom">scaling</span> <span class="nn">factor</span><span class="p">:</span><span class="mf">3.091598974159624</span>
<span class="nv">Tree</span> <span class="s s-Atom">scaling</span> <span class="nf">factor</span><span class="p">(</span><span class="nv">S</span><span class="p">)</span><span class="s s-Atom">:</span> <span class="mi">1</span>

<span class="nv">Using</span> <span class="s s-Atom">dN</span><span class="o">/</span><span class="s s-Atom">dS</span><span class="o">=</span><span class="mf">0.02681098065530952</span>
<span class="nv">Codon</span> <span class="nn">model</span><span class="p">:</span><span class="o">-</span><span class="mf">6564.63922229292</span>

<span class="nv">Phase</span> <span class="mi">4</span><span class="s s-Atom">:</span> <span class="nv">Ancestral</span> <span class="nv">State</span> <span class="nv">Reconstruction</span> <span class="s s-Atom">and</span> <span class="nv">Counting</span>
</pre></div>


<p>After step 10, for each codon, a line like this will be printed (this will also be saved to the final CSV file).</p>
<div class="code"><pre><span></span>| Codon:  249| Beta1:       0.86| P(Beta1):  0.00| Beta2:       2.50| P(Beta2):  1.00| alpha:       0.00| LRT:   7.62| p:  0.01| Log(L): -33.85 *P
</pre></div>


<ul>
<li>&alpha; is the estimate for the synonymous rate at this site shared by all branches</li>
<li>&beta;1 is the estimate for the first non-synonymous rate; by definition &beta;1 &le; &alpha;</li>
<li>P(&beta;1) is the proportion of branches at that site which are estimated to evolve with with &beta;1</li>
<li>&beta;2 is the estimate for the second non-synonymous rate; &beta;2 is unconstrained</li>
<li>P(&beta;2) is the proportion of branches at that site which are estimated to evolve with with &beta;2</li>
<li>LRT is the likelihood ratio test statistic obtained relative to the null which sets &beta;2  &le; &alpha;</li>
<li>p is the p-value for positive selection at this site</li>
<li>if *P is displayed at the end of the line, the p-value is at or below the threshold chosen in step 9.</li>
</ul>
<h3 id="questions_3">Questions<a class="headerlink" href="#questions_3" title="Permanent link">#</a></h3>
<ol>
<li>Find sites detected as selected by MEME, but not by FUBAR. What makes them different from those which are detected by both methods?</li>
<li>Using R (or another data analysis package), plot how LRT (or p-value) varies over sites.</li>
<li>Is <code>(1-p)</code> [p-value] of MEME correlated with the posterior probability of positive selection derived by FUBAR (use a non-parametric association test, e.g. rank correlation)? Use the CSV files generated by each analysis to import the results into a statistical package for analysis.</li>
</ol>
<hr />
<h2 id="use-relax-to-compare-selective-pressures-on-different-parts-of-the-tree">Use RELAX to compare selective pressures on different parts of the tree<a class="headerlink" href="#use-relax-to-compare-selective-pressures-on-different-parts-of-the-tree" title="Permanent link">#</a></h2>
<blockquote>
<p>RELAX is a method described in <a href="http://www.ncbi.nlm.nih.gov/pubmed/25540451">Wertheim et al</a>. It is based on the <a href="http://www.ncbi.nlm.nih.gov/pubmed/21670087">BS-REL model</a> branch site framework, but the tree is partitioned (a priori) into non-overlapping sets of branches, and the separate distributions of &omega; are fitted to each set and compared for relative <em>relaxation</em> (&omega; values contract to 1) or <em>intensification</em> (&omega; values move away from 1).</p>
</blockquote>
<p>We continue using the <code>HIV.nex</code> dataset, and are now interested in seeing if natural selection in the recipient (<code>R</code> branches) and the donor (<code>D</code> branches) operate at different intensities.</p>
<ol>
<li>Select the appropriate analysis to run</li>
<li><strong>[GUI]</strong> Choose <em>Analysis:Standard Analyses:Positive Selection:RELAX.bf</em></li>
<li><strong>[CLI]</strong> When presented with the list of standard analysis options upon launch, choose <em>Positive Selection</em>, then option 10 (<em>Test whether selected branches are under relaxed or intensified selection against reference branches.</em>)</li>
<li><strong>Universal</strong> genetic code option</li>
<li>The file to process</li>
<li><strong>[GUI]</strong> In the file dialog, navigate to and select <code>HIV.nex</code></li>
<li><strong>[CLI]</strong> Input the full path name to the file (make sure there is no trailing space), e.g. <code>/Users/sergei/Coding/hyphy-tutorials/selection/data/HIV.nex</code></li>
<li>Decline to use the tree included in the file (we will use a tree with different branch annotation)</li>
<li><strong>[GUI]</strong> Type <strong>n</strong> into the bottom box of the console window and hit Enter</li>
<li><strong>[CLI]</strong> Type <strong>n</strong> and hit Enter</li>
<li>Choose the tree file</li>
<li><strong>[GUI]</strong> In the file dialog, navigate to and select <code>HIV-relax.nwk'</code></li>
<li><strong>[CLI]</strong> Input the full path name to the file (make sure there is no trailing space), e.g. <code>/Users/sergei/Coding/hyphy-tutorials/selection/data/HIV-relax.nwk</code></li>
<li>Select the <strong>test</strong> set of branches</li>
<li><strong>[GUI]</strong> Choose <em>Recipient</em> </li>
<li><strong>[CLI]</strong> Choose option 3 (<em>Recipient</em>)</li>
<li>Select the <strong>reference</strong> set of branches</li>
<li><strong>[GUI]</strong> Choose <em>Donor</em> </li>
<li><strong>[CLI]</strong> Choose option 2 (<em>Donor</em>)</li>
<li>Select analysis type (selecting <em>Minimal</em> will greatly reduce run time)</li>
<li><strong>[GUI]</strong> Choose <em>Minimal</em> </li>
<li><strong>[CLI]</strong> Choose option 2 (<em>Minimal</em>)</li>
</ol>
<p><strong>The output of the analysis will look like</strong> </p>
<div class="code"><pre><span></span>[RELAX] Obtaining branch lengths under the GTR model 
[RELAX] Log(L) = -2114.132338088236 
[RELAX] Obtaining omega and branch length estimates under the partitioned MG94xGTR model 
[RELAX] Log(L) = -2076.093223041783 
[RELAX] Fitting the RELAX null model 
[RELAX] Log(L) = -2031.204697143867 
[RELAX] Fitting the RELAX alternative model 
[RELAX] Log(L) = -2024.075837744705. Relaxation parameter K = 0.4389230603260226 
[RELAX] Likelihood ratio test for relaxation on Test branches, p = 0.0001594057084282063 
</pre></div>


<p>The result of the analysis is that "Test" (recipient) branches have &omega; that scales like &omega; <sup>K</sup>, where <strong>K</strong> is 0.4389, i.e., shrink towards 1 (selection is weaker). The likelihood ratio test is to reject <strong>K=1</strong> (no difference is selective pressure), which yields a highly significant p = 0.00016 here.</p>
<p>Like in other analyses, HyPhy will generate a JSON file (e.g., <code>HIV.nex.RELAX.json</code>) storing all the relevant analysis output, which can be visualized with this <a href="http://veg.github.io/hyphy-vision/relax/">web app</a>. For example, you can see the fitted rate distributions.</p>
			 <!--
          <aside class="copyright" role="note">
            
            Documentation built with
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a>
            using the
            <a href="http://squidfunk.github.io/mkdocs-material/" target="_blank">
              Michael Li's Custom Theme
            </a>
            theme.
          </aside>
				-->
          
            <footer class="footer">
              
  <nav class="pagination" aria-label="Footer">
    <div class="previous">
      
        <a href="../../../installation/" title="Installation">
          <span class="direction">
            Previous
          </span>
          <div class="page">
            <div class="button button-previous" role="button" aria-label="Previous">
              <i class="icon icon-back"></i>
            </div>
            <div class="stretch">
              <div class="title">
                Installation
              </div>
            </div>
          </div>
        </a>
      
    </div>
    <div class="next">
      
        <a href="../../../glossary/" title="Glossary">
          <span class="direction">
            Next
          </span>
          <div class="page">
            <div class="stretch">
              <div class="title">
                Glossary
              </div>
            </div>
            <div class="button button-next" role="button" aria-label="Next">
              <i class="icon icon-forward"></i>
            </div>
          </div>
        </a>
      
    </div>
  </nav>

            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '../../..';
      var repo_id  = '';
    </script>
    <script src="../../../assets/javascripts/application.js"></script>
    
    
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', 'https://www.google-analytics.com/analytics.js', 'ga');
        /* General initialization */
        ga('create', 'UA-36723568-3', 'mkdocs.org');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
        /* Track outbound links */
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
        /* Register handler to log search on blur */
        var query = document.querySelector('.query');
        query.addEventListener('blur', function() {
          if (this.value) {
            var path = document.location.pathname;
            ga('send', 'pageview', path + '?q=' + this.value);
          }
        });
      </script>
    
  </body>
</html>